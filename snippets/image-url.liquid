{% liquid
  # theme-check-disable ImgLazyLoading 
  # theme-check-disable RemoteAsset
%}

{% comment %}
  Renders an image tag throught the Shopify's, image_url filter
  https://shopify.dev/docs/api/liquid/filters/image_url

  Accepts:
  - img: {object} The image object to apply the filter
  - size: {Number} (Optional) The preferred image size which the image width/height will be handled. (default is 600)
  - ratio: {String} (Optional) The image ratio (orientation). (default is adapt)
  - loading {String} {Optional} The image loading mode. Either lazy or eager. (default is lazy)
  - scale {Boolean} {Optional}. Useful if your images are looking blurred. (default is false)
  - only_src {Boolean} {Optional} Set to true to retrive only the image source and not the the whole image tag (default is false)
  - class: {String} (Optional) An optional class to apply to the Img element

  Usage:
  {% render 'image-url' img: product.featured_image, size: 600, ratio: 'ratio-1x1', loading: 'lazy', scale: false, only_src: false, class: "mb-4"  %}
{% endcomment %}

{% liquid
  assign size = size | default: 600
  assign ratio = ratio | default: 'adapt'
  assign loading = loading | default: 'lazy'

  case ratio
    when 'ratio-1x1'
      assign width = size
      assign height = size 
    when 'ratio-4x3'
      assign width = size
      assign height = size | divided_by: 4 | times: 3 | round
    when 'ratio-16x9'
      assign width = size
      assign height = size | divided_by: 16 | times: 9 | round
      when 'ratio-21x9'
      assign width = size
      assign height = size | divided_by: 21 | times: 9 | round
    when 'ratio-3x4'
      assign width = size | divided_by: 4 | times: 3 | round
      assign height = size
    when 'ratio-9x16'
      assign width = size | divided_by: 16 | times: 9 | round
      assign height = size
    when 'ratio-9x21'
      assign width = size | divided_by: 21 | times: 9 | round
      assign height = size
    else
      assign width  = size
      assign height = size | divided_by: img.aspect_ratio | round
  endcase

  if scale
    assign width_scaled = width | times: 2
    assign height_scaled = height | times: 2
  else
    assign width_scaled = width
    assign height_scaled = height
  endif
%}

{% if only_src %}
  {{ img | image_url: width: width_scaled, height: height_scaled, crop: 'center' }}
{% else %}
  <img
    src="{{ img | image_url: width: width_scaled, height: height_scaled, crop: 'center' }}"
    srcset="
      {% if img.width >= 350 %}{{ img | image_url: width: 350, crop: 'center' }} 350w,{% endif %}
      {% if img.width >= 750 %}{{ img | image_url: width: 750, crop: 'center' }} 750w,{% endif %}
      {% if img.width >= 1100 %}{{ img | image_url: width: 1100, crop: 'center' }} 1100w,{% endif %}
      {% if img.width >= 1500 %}{{ img | image_url: width: 1500, crop: 'center' }} 1500w,{% endif %}
      {% if img.width >= 2200 %}{{ img | image_url: width: 2200, crop: 'center' }} 2200w,{% endif %}
      {{ img | image_url: width: width_scaled, height: height_scaled, crop: 'center' }} {{ width_scaled }}w
    "
    sizes="(max-width: 749px) 100vw, (max-width: 999px) 50vw, 33vw"
    class="img-fluid {{ class }}"
    alt="{{ img.alt | escape }}"
    width="{{ width }}"
    height="{{ height }}"
    loading="{{ loading }}"
    decoding="async">
{% endif %}

{% liquid
  # theme-check-enable ImgLazyLoading 
  # theme-check-enable RemoteAsset
%} 